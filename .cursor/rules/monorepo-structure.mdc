---
alwaysApply: true
---

# Monorepo Structure & Turborepo

## ğŸ—ï¸ Monorepo Overview

### Structure
```
webdevstudios/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/              # Next.js frontend application
â”‚   â””â”€â”€ api/              # NestJS backend application
â”œâ”€â”€ docs/                 # Project documentation
â”œâ”€â”€ .cursor/
â”‚   â””â”€â”€ rules/            # Cursor IDE rules
â”œâ”€â”€ package.json          # Root workspace config
â”œâ”€â”€ pnpm-workspace.yaml   # pnpm workspace config
â”œâ”€â”€ turbo.json            # Turborepo config
â””â”€â”€ MEMORIZE.md           # Session memory
```

### Package Manager
- **pnpm**: Version 10.26.1
- **Workspace**: pnpm workspaces vá»›i `pnpm-workspace.yaml`
- **Install**: `pnpm install` á»Ÿ root Ä‘á»ƒ install táº¥t cáº£ dependencies

## ğŸš€ Turborepo Configuration

### turbo.json
```json
{
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "!.next/cache/**", "dist/**"]
    },
    "lint": {
      "dependsOn": ["^lint"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
```

### Task Dependencies
- **build**: Depends on dependencies' build (`^build`)
- **lint**: Depends on dependencies' lint (`^lint`)
- **dev**: No cache, persistent (dev server)

## ğŸ“¦ Apps Structure

### Frontend App (`apps/web`)
```
apps/web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/              # Next.js App Router
â”‚   â”œâ”€â”€ components/       # React components
â”‚   â”œâ”€â”€ lib/              # Utilities
â”‚   â”œâ”€â”€ types/            # TypeScript types
â”‚   â””â”€â”€ data/             # Static data (temporary)
â”œâ”€â”€ public/               # Static assets
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ next.config.ts
```

**Key Points**:
- Next.js 16 vá»›i App Router
- TypeScript strict mode
- Tailwind CSS v4
- Path alias: `@/*` â†’ `src/*`

### Backend App (`apps/api`)
```
apps/api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ modules/          # Feature modules (CQRS)
â”‚   â”œâ”€â”€ common/          # Shared utilities
â”‚   â”œâ”€â”€ prisma/          # Prisma client & module
â”‚   â”œâ”€â”€ mail/            # Email service
â”‚   â”œâ”€â”€ redis/           # Redis service
â”‚   â””â”€â”€ main.ts          # Entry point
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema/          # Prisma schema files
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**Key Points**:
- NestJS 11 vá»›i CQRS pattern
- Prisma ORM vá»›i PostgreSQL
- Modular architecture
- TypeScript strict mode

## ğŸ”§ Workspace Configuration

### pnpm-workspace.yaml
```yaml
packages:
  - 'apps/*'
```

### Root package.json Scripts
```json
{
  "scripts": {
    "dev": "turbo run dev --parallel",
    "build": "turbo run build",
    "lint": "turbo run lint",
    "format": "prettier --write ...",
    "clean": "turbo run clean"
  }
}
```

## ğŸ“‹ Shared Dependencies

### Development Dependencies (Root)
- **turbo**: Monorepo build system
- **prettier**: Code formatting
- **husky**: Git hooks
- **lint-staged**: Pre-commit linting
- **typescript**: TypeScript compiler

### App-Specific Dependencies
- **apps/web**: Next.js, React, Tailwind, motion/react
- **apps/api**: NestJS, Prisma, Passport, JWT

## ğŸ”„ Development Workflow

### Starting Development
```bash
# Install all dependencies
pnpm install

# Start all apps in parallel
pnpm dev
```

### Building
```bash
# Build all apps
pnpm build

# Build specific app
cd apps/web && pnpm build
```

### Linting & Formatting
```bash
# Lint all apps
pnpm lint

# Format all code
pnpm format
```

## ğŸ“ File Organization Rules

### Shared Code
- **No Shared Packages**: Hiá»‡n táº¡i khÃ´ng cÃ³ shared packages
- **Future**: CÃ³ thá»ƒ táº¡o `packages/` folder cho shared code

### Documentation
- **Root Docs**: `docs/` folder á»Ÿ root
- **App Docs**: CÃ³ thá»ƒ cÃ³ `README.md` trong má»—i app
- **Rules**: `.cursor/rules/` cho Cursor IDE rules

## ğŸ” Turborepo Features

### Caching
- **Build Cache**: Turborepo caches build outputs
- **Task Cache**: Caches task results (lint, test, etc.)
- **Cache Key**: Based on inputs (files, dependencies)

### Parallel Execution
- **Parallel Tasks**: Tasks cÃ³ thá»ƒ cháº¡y parallel náº¿u khÃ´ng cÃ³ dependencies
- **Dependency Graph**: Turborepo tá»± Ä‘á»™ng resolve dependencies

### Remote Caching (Future)
- **Vercel Remote Cache**: CÃ³ thá»ƒ setup remote cache vá»›i Vercel
- **Custom Remote Cache**: CÃ³ thá»ƒ setup custom remote cache

## ğŸš« Common Mistakes

### âŒ Don't Do This
- âŒ Install dependencies á»Ÿ root thay vÃ¬ app folder
- âŒ Hardcode paths giá»¯a apps
- âŒ Duplicate dependencies khÃ´ng cáº§n thiáº¿t
- âŒ Ignore Turborepo cache

### âœ… Do This Instead
- âœ… Install dependencies á»Ÿ Ä‘Ãºng location
- âœ… Use proper imports (relative hoáº·c path aliases)
- âœ… Share common dependencies á»Ÿ root náº¿u cÃ³ thá»ƒ
- âœ… Leverage Turborepo caching

## ğŸ“Š Dependency Management

### Version Management
- **Lock File**: `pnpm-lock.yaml` á»Ÿ root
- **Version Sync**: CÃ¹ng version cho shared dependencies
- **Updates**: Update dependencies vá»›i `pnpm update`

### Peer Dependencies
- **React**: Shared peer dependency giá»¯a apps
- **TypeScript**: Shared dev dependency

## ğŸ” Environment Variables

### Frontend (`apps/web`)
- **File**: `.env.local`
- **Prefix**: `NEXT_PUBLIC_*` cho public variables
- **Example**: `NEXT_PUBLIC_SITE_URL`

### Backend (`apps/api`)
- **File**: `.env`
- **No Prefix**: Backend variables khÃ´ng cáº§n prefix
- **Example**: `JWT_SECRET_KEY`, `DATABASE_URL`

### Root
- **No Env File**: Root khÃ´ng cÃ³ env file
- **Shared Config**: CÃ³ thá»ƒ cÃ³ shared config náº¿u cáº§n

## ğŸ§ª Testing in Monorepo

### Test Structure
- **Unit Tests**: Trong má»—i app
- **E2E Tests**: CÃ³ thá»ƒ á»Ÿ root hoáº·c trong app
- **Shared Test Utils**: CÃ³ thá»ƒ táº¡o shared test utilities

### Running Tests
```bash
# Run all tests
pnpm test

# Run tests for specific app
cd apps/web && pnpm test
```

## ğŸ“ Best Practices

### Code Organization
1. **Separation**: Má»—i app Ä‘á»™c láº­p, khÃ´ng hardcode dependencies
2. **Shared Code**: Extract shared code vÃ o packages náº¿u cáº§n
3. **Documentation**: Document dependencies giá»¯a apps

### Build Optimization
1. **Cache**: Leverage Turborepo caching
2. **Parallel**: Run independent tasks in parallel
3. **Incremental**: Use incremental builds

### Development Experience
1. **Hot Reload**: Both apps support hot reload
2. **Type Safety**: Shared types náº¿u cáº§n (cÃ³ thá»ƒ táº¡o shared package)
3. **Linting**: Consistent linting rules across apps

## ğŸ¯ Future Improvements

### Potential Additions
- **Shared Packages**: `packages/ui`, `packages/types`, `packages/utils`
- **Shared Config**: ESLint, Prettier configs
- **CI/CD**: GitHub Actions vá»›i Turborepo
- **Remote Cache**: Vercel Remote Cache hoáº·c custom solution
