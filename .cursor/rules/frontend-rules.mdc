---
globs: apps/web/**/*.{ts,tsx,js,jsx}
alwaysApply: false
---

# Frontend Rules - Next.js 16 & React

## ğŸ¯ Core Principles

### React Server Components First
- **Priority**: Æ¯u tiÃªn Server Components, chá»‰ dÃ¹ng `'use client'` khi thá»±c sá»± cáº§n thiáº¿t
- **When to use 'use client'**:
  - Interactive components (onClick, onChange, useState, useEffect)
  - Browser APIs (localStorage, window, document)
  - Third-party libraries yÃªu cáº§u client-side
  - Animations vá»›i motion/react (cáº§n browser APIs)

### Component Structure
```typescript
// âœ… Good: Server Component (default)
export default function ProductPage() {
  // Fetch data, no client-side logic
}

// âœ… Good: Client Component (when needed)
'use client'
export function ProductActions() {
  const [quantity, setQuantity] = useState(1)
  // Interactive logic
}
```

## ğŸ“ File & Directory Conventions

### Naming
- **Files**: `kebab-case` (e.g., `product-actions.tsx`)
- **Components**: `PascalCase` (e.g., `ProductActions`)
- **Directories**: `kebab-case` (e.g., `components/shop/`)
- **Types**: `PascalCase` vá»›i suffix `Type` hoáº·c `Props` (e.g., `ProductType`, `ProductActionsProps`)

### Directory Structure
```
src/
â”œâ”€â”€ app/              # Next.js App Router pages
â”‚   â”œâ”€â”€ layout.tsx    # Root layout
â”‚   â”œâ”€â”€ page.tsx      # Home page
â”‚   â””â”€â”€ shop/         # Shop routes
â”œâ”€â”€ components/       # Reusable components
â”‚   â”œâ”€â”€ ui/          # shadcn/ui components
â”‚   â”œâ”€â”€ wds/         # WebDev Studios components
â”‚   â””â”€â”€ shop/        # E-commerce components
â”œâ”€â”€ lib/             # Utilities & helpers
â”œâ”€â”€ types/           # TypeScript types
â””â”€â”€ data/            # Static data (temporary, sáº½ migrate sang API)
```

## ğŸ¨ Styling Rules

### Tailwind CSS v4
- **Approach**: Utility-first, mobile-first
- **Custom Utilities**: Sá»­ dá»¥ng `@layer utilities` trong `globals.css`
- **Theme Colors**: Sá»­ dá»¥ng CSS variables cho WDS colors
  ```css
  --wds-black: #000000;
  --wds-white: #ffffff;
  --wds-orange: #f7931e;
  --wds-cream: #fff8e1;
  ```

### Responsive Design
- **Breakpoints**: `sm:`, `md:`, `lg:`, `xl:`, `2xl:`
- **Mobile First**: Viáº¿t styles cho mobile trÆ°á»›c, sau Ä‘Ã³ override cho desktop
- **Example**:
  ```tsx
  <div className="text-sm md:text-base lg:text-lg">
    Responsive text
  </div>
  ```

### Image Optimization
- **Format**: WebP (Æ°u tiÃªn), fallback PNG/JPG
- **Component**: LuÃ´n dÃ¹ng Next.js `Image` component
- **Required Props**: `src`, `alt`, `width`, `height` hoáº·c `fill`
- **Priority**: Set `priority={true}` cho images above the fold
- **Sizes**: LuÃ´n specify `sizes` prop cho responsive images
- **Example**:
  ```tsx
  <Image
    src="/image/hero.webp"
    alt="Hero image"
    width={1200}
    height={600}
    priority
    sizes="(max-width: 768px) 100vw, 1200px"
  />
  ```

## ğŸ­ Animation Rules

### motion/react Library
- **Import**: `import { motion } from 'motion/react'`
- **Performance**: Sá»­ dá»¥ng `whileInView` cho scroll animations thay vÃ¬ `useEffect`
- **Variants**: Äá»‹nh nghÄ©a animation variants Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng
- **Example**:
  ```tsx
  const fadeInUp = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0 }
  }
  
  <motion.div
    initial="hidden"
    whileInView="visible"
    variants={fadeInUp}
    transition={{ duration: 0.5 }}
  >
    Content
  </motion.div>
  ```

## ğŸ”„ State Management

### Server State
- **Data Fetching**: Sá»­ dá»¥ng async Server Components
- **Caching**: Next.js built-in caching (fetch cache, route cache)
- **Example**:
  ```tsx
  export default async function ProductPage({ params }) {
    const product = await fetchProduct(params.slug)
    return <ProductDetails product={product} />
  }
  ```

### Client State
- **Simple State**: `useState` cho local component state
- **Form State**: CÃ³ thá»ƒ dÃ¹ng React Hook Form (náº¿u cáº§n)
- **Global State**: CÃ¢n nháº¯c Zustand hoáº·c Context API (náº¿u thá»±c sá»± cáº§n)

### API State Management (TanStack Query)
- **Library**: `@tanstack/react-query` cho client-side data fetching
- **Purpose**: Quáº£n lÃ½ server state, caching, synchronization
- **Setup**: Wrap app vá»›i `QueryClientProvider`
- **Example**:
  ```tsx
  // Setup QueryClient
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: {
        staleTime: 60 * 1000, // 1 minute
        refetchOnWindowFocus: false,
      },
    },
  })
  
  // In app
  <QueryClientProvider client={queryClient}>
    <App />
  </QueryClientProvider>
  ```

## ğŸ›¡ï¸ Type Safety

### TypeScript Rules
- **Strict Mode**: LuÃ´n báº­t TypeScript strict mode
- **Avoid `any`**: KhÃ´ng dÃ¹ng `any`, dÃ¹ng `unknown` náº¿u cáº§n
- **Type Definitions**: Äá»‹nh nghÄ©a types trong `src/types/`
- **Props Types**: LuÃ´n type props cá»§a components
- **Example**:
  ```tsx
  interface ProductActionsProps {
    productId: string
    stock: number
    onAddToCart: (quantity: number) => void
  }
  
  export function ProductActions({ productId, stock, onAddToCart }: ProductActionsProps) {
    // ...
  }
  ```

## ğŸ“¡ API Integration

### API Client Setup
- **HTTP Client**: Axios cho HTTP requests
- **State Management**: TanStack Query (React Query) cho data fetching vÃ  caching
- **Location**: 
  - API client: `src/lib/api/client.ts` (axios instance)
  - API services: `src/lib/api/services/` (API functions)
  - Query hooks: `src/lib/api/hooks/` (TanStack Query hooks)

### Axios Client Configuration
```tsx
// src/lib/api/client.ts
import axios from 'axios'

const apiClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || '/api',
  headers: {
    'Content-Type': 'application/json',
  },
})

// Request interceptor (e.g., add auth token)
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// Response interceptor (e.g., handle errors)
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    // Handle common errors (401, 403, 500, etc.)
    if (error.response?.status === 401) {
      // Redirect to login
    }
    return Promise.reject(error)
  }
)

export default apiClient
```

### API Services with Axios
```tsx
// src/lib/api/services/cart.service.ts
import apiClient from '../client'

export interface AddToCartRequest {
  productId: string
  quantity: number
  size?: string
}

export interface CartItem {
  id: string
  productId: string
  quantity: number
  size?: string
}

export const cartService = {
  addToCart: async (data: AddToCartRequest): Promise<CartItem> => {
    const response = await apiClient.post<CartItem>('/cart/add', data)
    return response.data
  },
  
  getCart: async (): Promise<CartItem[]> => {
    const response = await apiClient.get<CartItem[]>('/cart')
    return response.data
  },
  
  updateCartItem: async (itemId: string, quantity: number): Promise<CartItem> => {
    const response = await apiClient.put<CartItem>(`/cart/items/${itemId}`, { quantity })
    return response.data
  },
  
  removeCartItem: async (itemId: string): Promise<void> => {
    await apiClient.delete(`/cart/items/${itemId}`)
  },
}
```

### TanStack Query Hooks
```tsx
// src/lib/api/hooks/use-cart.ts
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query'
import { cartService, AddToCartRequest } from '../services/cart.service'

// Query: Get cart items
export function useCart() {
  return useQuery({
    queryKey: ['cart'],
    queryFn: () => cartService.getCart(),
    staleTime: 30 * 1000, // 30 seconds
  })
}

// Mutation: Add to cart
export function useAddToCart() {
  const queryClient = useQueryClient()
  
  return useMutation({
    mutationFn: (data: AddToCartRequest) => cartService.addToCart(data),
    onSuccess: () => {
      // Invalidate cart query to refetch
      queryClient.invalidateQueries({ queryKey: ['cart'] })
    },
    onError: (error) => {
      // Handle error (show toast, etc.)
      console.error('Failed to add to cart:', error)
    },
  })
}

// Mutation: Update cart item
export function useUpdateCartItem() {
  const queryClient = useQueryClient()
  
  return useMutation({
    mutationFn: ({ itemId, quantity }: { itemId: string; quantity: number }) =>
      cartService.updateCartItem(itemId, quantity),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['cart'] })
    },
  })
}

// Mutation: Remove cart item
export function useRemoveCartItem() {
  const queryClient = useQueryClient()
  
  return useMutation({
    mutationFn: (itemId: string) => cartService.removeCartItem(itemId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['cart'] })
    },
  })
}
```

### Using Hooks in Components
```tsx
'use client'
import { useCart, useAddToCart } from '@/lib/api/hooks/use-cart'

export function CartButton({ productId, size }: { productId: string; size?: string }) {
  const { data: cart, isLoading } = useCart()
  const addToCart = useAddToCart()
  
  const handleAddToCart = () => {
    addToCart.mutate(
      { productId, quantity: 1, size },
      {
        onSuccess: () => {
          // Show success toast
          toast.success('ÄÃ£ thÃªm vÃ o giá» hÃ ng')
        },
        onError: (error) => {
          // Show error toast
          toast.error('KhÃ´ng thá»ƒ thÃªm vÃ o giá» hÃ ng')
        },
      }
    )
  }
  
  return (
    <button
      onClick={handleAddToCart}
      disabled={addToCart.isPending || isLoading}
    >
      {addToCart.isPending ? 'Äang thÃªm...' : 'ThÃªm vÃ o giá»'}
    </button>
  )
}
```

### Best Practices
- **Error Handling**: LuÃ´n handle errors trong `onError` callback cá»§a mutations
- **Loading States**: Sá»­ dá»¥ng `isPending`, `isLoading` tá»« hooks
- **Optimistic Updates**: CÃ³ thá»ƒ dÃ¹ng `onMutate` cho optimistic updates
- **Cache Invalidation**: Invalidate queries sau mutations Ä‘á»ƒ sync data
- **Query Keys**: Sá»­ dá»¥ng consistent query keys (arrays vá»›i proper structure)
- **Type Safety**: Type táº¥t cáº£ API responses vÃ  requests

## â™¿ Accessibility

### Required Practices
- **Alt Text**: LuÃ´n cÃ³ `alt` cho images
- **ARIA Labels**: Sá»­ dá»¥ng khi cáº§n thiáº¿t
- **Keyboard Navigation**: Äáº£m báº£o táº¥t cáº£ interactive elements cÃ³ thá»ƒ navigate báº±ng keyboard
- **Focus Indicators**: Visible focus states
- **Semantic HTML**: Sá»­ dá»¥ng Ä‘Ãºng HTML elements (`<button>`, `<nav>`, `<main>`, etc.)

### Component Reusability Priority

**QUAN TRá»ŒNG**: LuÃ´n Æ°u tiÃªn sá»­ dá»¥ng components cÃ³ sáºµn trÆ°á»›c khi táº¡o component má»›i.

#### Priority Order:
1. **shadcn/ui Components** (`src/components/ui/`)
   - Kiá»ƒm tra xem component Ä‘Ã£ cÃ³ trong `src/components/ui/` chÆ°a
   - Náº¿u chÆ°a cÃ³, cÃ i Ä‘áº·t tá»« shadcn/ui registry: `npx shadcn@latest add [component-name]`
   - shadcn/ui components Ä‘Ã£ cÃ³ sáºµn accessibility, keyboard navigation, ARIA labels
   - **Available Components**: button, input, navigation-menu, vÃ  nhiá»u components khÃ¡c tá»« shadcn/ui

2. **Custom Components trong Project** (`src/components/`)
   - Kiá»ƒm tra xem Ä‘Ã£ cÃ³ custom component tÆ°Æ¡ng tá»± chÆ°a
   - Xem trong `src/components/wds/`, `src/components/shop/` hoáº·c cÃ¡c folder khÃ¡c
   - CÃ³ thá»ƒ extend/modify component cÃ³ sáºµn thay vÃ¬ táº¡o má»›i

3. **Táº¡o Component Má»›i** (chá»‰ khi khÃ´ng cÃ³ sáºµn)
   - Chá»‰ táº¡o component má»›i khi:
     - KhÃ´ng cÃ³ trong shadcn/ui registry
     - KhÃ´ng cÃ³ custom component tÆ°Æ¡ng tá»± trong project
     - Component cáº§n thiáº¿t cho business logic Ä‘áº·c thÃ¹

#### Examples:

```tsx
// âœ… Good: Sá»­ dá»¥ng Button tá»« shadcn/ui
import { Button } from '@/components/ui/button'

export function ProductActions() {
  return (
    <Button onClick={handleAddToCart}>
      ThÃªm vÃ o giá»
    </Button>
  )
}

// âŒ Bad: Táº¡o button má»›i thay vÃ¬ dÃ¹ng component cÃ³ sáºµn
export function ProductActions() {
  return (
    <button className="px-4 py-2 bg-blue-500" onClick={handleAddToCart}>
      ThÃªm vÃ o giá»
    </button>
  )
}
```

```tsx
// âœ… Good: Sá»­ dá»¥ng Input tá»« shadcn/ui
import { Input } from '@/components/ui/input'

export function SearchForm() {
  return <Input type="search" placeholder="TÃ¬m kiáº¿m..." />
}

// âŒ Bad: Táº¡o input má»›i
export function SearchForm() {
  return (
    <input 
      type="search" 
      className="px-4 py-2 border rounded"
      placeholder="TÃ¬m kiáº¿m..."
    />
  )
}
```

#### shadcn/ui Component Installation:
```bash
# CÃ i Ä‘áº·t component tá»« shadcn/ui
npx shadcn@latest add button
npx shadcn@latest add input
npx shadcn@latest add dialog
npx shadcn@latest add dropdown-menu
# ... vÃ  nhiá»u components khÃ¡c
```

#### Available shadcn/ui Components:
- **Form Components**: button, input, textarea, select, checkbox, radio-group, switch, label
- **Layout Components**: card, separator, sheet, dialog, drawer, popover, tooltip
- **Navigation**: navigation-menu, breadcrumb, tabs, pagination
- **Data Display**: table, badge, avatar, progress, skeleton
- **Feedback**: alert, toast, alert-dialog
- **Overlay**: dropdown-menu, context-menu, hover-card
- **VÃ  nhiá»u components khÃ¡c**: Xem táº¡i https://ui.shadcn.com/docs/components

#### Customization:
- shadcn/ui components cÃ³ thá»ƒ customize dá»… dÃ ng vá»›i Tailwind CSS
- CÃ³ thá»ƒ extend props, thÃªm variants vá»›i `class-variance-authority`
- Giá»¯ nguyÃªn accessibility features khi customize

## ğŸ§ª Testing (Future)

### Testing Strategy
- **Unit Tests**: Jest + React Testing Library
- **E2E Tests**: Playwright (náº¿u cáº§n)
- **Component Tests**: Test UI components vá»›i user interactions

## ğŸ“ Code Quality

### Linting & Formatting
- **ESLint**: Next.js ESLint config vá»›i custom rules
- **Prettier**: Auto-format vá»›i Tailwind plugin
- **Pre-commit**: Husky + lint-staged

### Best Practices
1. **Component Size**: Giá»¯ components nhá», single responsibility
2. **Reusability**: Extract reusable logic vÃ o custom hooks
3. **Performance**: 
   - Lazy load components vá»›i `dynamic()` khi cáº§n
   - Optimize images
   - Minimize client-side JavaScript
4. **SEO**: 
   - Metadata cho má»—i page
   - Structured data (JSON-LD)
   - Semantic HTML

## ğŸš« Anti-Patterns

### âŒ Don't Do This
- âŒ DÃ¹ng `'use client'` khÃ´ng cáº§n thiáº¿t
- âŒ Fetch data trong `useEffect` khi cÃ³ thá»ƒ dÃ¹ng Server Components
- âŒ Hardcode data thay vÃ¬ fetch tá»« API
- âŒ Ignore TypeScript errors
- âŒ Skip alt text cho images
- âŒ Use inline styles thay vÃ¬ Tailwind classes
- âŒ Create large components (>200 lines)

### âœ… Do This Instead
- âœ… Æ¯u tiÃªn Server Components
- âœ… Fetch data trong Server Components
- âœ… Integrate vá»›i API endpoints
- âœ… Fix TypeScript errors
- âœ… Always provide alt text
- âœ… Use Tailwind utility classes
- âœ… Split large components into smaller ones
