---
alwaysApply: true
---

# Development Workflow & Best Practices

## ğŸ”„ Development Process

### Step 1: Context Retrieval
- **Before Starting**: Äá»c `MEMORIZE.md` vÃ  `FEATURES.log` Ä‘á»ƒ hiá»ƒu context
- **Check Documentation**: Xem cÃ¡c docs trong `docs/` folder
- **Review Rules**: Xem láº¡i cÃ¡c rules trong `.cursor/rules/`

### Step 2: Planning & Brainstorming
- **Analyze Requirements**: PhÃ¢n tÃ­ch yÃªu cáº§u ká»¹ lÆ°á»¡ng
- **Propose Options**: ÄÆ°a ra 2-3 phÆ°Æ¡ng Ã¡n vá»›i Pros/Cons
- **Wait for Approval**: Chá» ngÆ°á»i dÃ¹ng chá»n phÆ°Æ¡ng Ã¡n trÆ°á»›c khi code

### Step 3: Implementation
- **Follow Architecture**: TuÃ¢n thá»§ kiáº¿n trÃºc Ä‘Ã£ Ä‘á»‹nh (CQRS, Clean Architecture)
- **Code Standards**: TuÃ¢n thá»§ coding standards (TypeScript, ESLint, Prettier)
- **Incremental**: Commit thÆ°á»ng xuyÃªn vá»›i messages rÃµ rÃ ng

### Step 4: Quality Assurance (MANDATORY)
- **Lint**: Cháº¡y `pnpm lint` vÃ  fix táº¥t cáº£ errors
- **Format**: Cháº¡y `pnpm format` Ä‘á»ƒ format code
- **Type Check**: Äáº£m báº£o TypeScript khÃ´ng cÃ³ errors
- **Test**: Test functionality manually hoáº·c vá»›i tests

## ğŸ“ Code Quality Standards

### TypeScript
- **Strict Mode**: LuÃ´n báº­t strict mode
- **No `any`**: KhÃ´ng dÃ¹ng `any`, dÃ¹ng `unknown` náº¿u cáº§n
- **Type Everything**: Type táº¥t cáº£ functions, variables, props
- **Enums**: Sá»­ dá»¥ng enums cho constants thay vÃ¬ strings

### Code Style
- **Formatting**: Prettier vá»›i Tailwind plugin
- **Linting**: ESLint vá»›i Next.js vÃ  NestJS configs
- **Imports**: Sorted imports (simple-import-sort) - **MANDATORY**
- **Comments**: Comment cho complex logic, JSDoc cho public APIs

### Import Order (simple-import-sort)
Imports **MUST** be sorted theo thá»© tá»± sau (tá»± Ä‘á»™ng bá»Ÿi ESLint):

1. **Side effects** (`import '...'`) - Imports khÃ´ng cÃ³ binding
2. **Node built-ins** (`import fs from 'node:fs'`) - Node.js built-in modules
3. **External libraries** (`import { ... } from '@nestjs/common'`) - Third-party packages
4. **Path aliases** (`import { ... } from '@/common'`) - Internal path aliases (náº¿u cÃ³)
5. **Relative imports** (`import { ... } from './file'`) - Relative imports

**Example**:
```typescript
// âœ… CORRECT - ÄÃºng thá»© tá»±
import 'reflect-metadata'; // Side effects
import { Injectable } from '@nestjs/common'; // External
import { CommandBus } from '@nestjs/cqrs'; // External
import { PrismaService } from '../prisma/prisma.service'; // Relative
import { CreateUserCommand } from './create-user.command'; // Relative

// âŒ WRONG - Sai thá»© tá»±
import { CreateUserCommand } from './create-user.command'; // Relative trÆ°á»›c
import { Injectable } from '@nestjs/common'; // External sau
```

**Auto-fix**: Cháº¡y `pnpm lint --fix` Ä‘á»ƒ tá»± Ä‘á»™ng sáº¯p xáº¿p imports

### File Organization
- **One Export Per File**: Má»—i file chá»‰ export má»™t main thing (component, function, class)
- **Co-location**: Äáº·t related files gáº§n nhau
- **Barrel Exports**: CÃ³ thá»ƒ dÃ¹ng `index.ts` Ä‘á»ƒ re-export

## ğŸ” Code Review Checklist

### Before Committing
- [ ] Code Ä‘Ã£ Ä‘Æ°á»£c lint vÃ  format
- [ ] TypeScript khÃ´ng cÃ³ errors
- [ ] Imports Ä‘Ã£ Ä‘Æ°á»£c sáº¯p xáº¿p Ä‘Ãºng thá»© tá»± (simple-import-sort)
- [ ] KhÃ´ng cÃ³ console.log hoáº·c debug code
- [ ] Comments rÃµ rÃ ng cho complex logic
- [ ] Error handling Ä‘áº§y Ä‘á»§
- [ ] Tests pass (náº¿u cÃ³)

### For Frontend
- [ ] Responsive design (mobile, tablet, desktop)
- [ ] Accessibility (alt text, ARIA labels, keyboard nav)
- [ ] Image optimization (WebP, proper sizes)
- [ ] Loading states cho async operations
- [ ] Error states cho failed operations

### For Backend
- [ ] CQRS pattern tuÃ¢n thá»§ (Commands/Queries tÃ¡ch biá»‡t)
- [ ] Validation vá»›i class-validator
- [ ] Error handling vá»›i proper HTTP status codes
- [ ] Authentication/Authorization checks
- [ ] Database queries optimized (no N+1)

## ğŸš€ Git Workflow

### Commit Messages
- **Format**: `[TYPE] - Description`
- **Types**: `feat`, `fix`, `chore`, `refactor`, `docs`, `style`
- **Examples**:
  - `feat: Add product detail page`
  - `fix: Fix cart quantity validation`
  - `refactor: Extract product API client`

### Branch Strategy
- **Main Branch**: `main` hoáº·c `master`
- **Feature Branches**: `feature/description`
- **Fix Branches**: `fix/description`
- **Hotfix Branches**: `hotfix/description`

### Pre-commit Hooks
- **Husky**: Git hooks vá»›i lint-staged
- **Auto-format**: Prettier format trÆ°á»›c khi commit
- **Lint Check**: ESLint check trÆ°á»›c khi commit

## ğŸ“‹ Feature Development Workflow

### 1. Planning Phase
1. PhÃ¢n tÃ­ch yÃªu cáº§u
2. Äá» xuáº¥t 2-3 phÆ°Æ¡ng Ã¡n
3. Chá» approval tá»« user
4. Táº¡o TODO list náº¿u task phá»©c táº¡p

### 2. Implementation Phase
1. Setup (náº¿u cáº§n): Táº¡o files, folders
2. Implement core logic
3. Add error handling
4. Add loading states (frontend)
5. Add validation (backend)

### 3. Integration Phase
1. Integrate vá»›i API (náº¿u frontend)
2. Test integration
3. Handle edge cases
4. Add proper error messages

### 4. Polish Phase
1. Format code
2. Add comments
3. Update documentation
4. Update FEATURES.log

## ğŸ› Bug Fixing Workflow

### 1. Reproduce
- Reproduce bug vá»›i steps rÃµ rÃ ng
- Identify root cause
- Check related code

### 2. Fix
- Implement fix
- Test fix thoroughly
- Check for regressions

### 3. Document
- Update FEATURES.log vá»›i `[FIX]` type
- Add comments náº¿u cáº§n
- Update documentation náº¿u behavior thay Ä‘á»•i

## ğŸ“š Documentation

### Code Documentation
- **JSDoc**: Cho public functions/classes
- **Comments**: Cho complex logic
- **README**: Cho má»—i module/feature lá»›n

### Project Documentation
- **MEMORIZE.md**: Session context, current state
- **FEATURES.log**: Feature history
- **docs/**: Detailed documentation

### API Documentation
- **Swagger**: Auto-generated tá»« NestJS decorators
- **Comments**: MÃ´ táº£ endpoints, parameters, responses

## ğŸ”§ Environment Setup

### Required Tools
- **Node.js**: >= 18.0.0
- **pnpm**: >= 8.0.0
- **PostgreSQL**: Database
- **Redis**: Optional, for caching

### Environment Variables
- **Frontend**: `.env.local` vá»›i `NEXT_PUBLIC_*` variables
- **Backend**: `.env` vá»›i database, JWT, etc.
- **Never Commit**: KhÃ´ng commit `.env` files

### Development Commands
```bash
# Start all apps
pnpm dev

# Build all apps
pnpm build

# Lint all apps
pnpm lint

# Format code
pnpm format

# Database migrations
cd apps/api && pnpm prisma:migrate

# Generate Prisma Client
cd apps/api && pnpm prisma:generate
```

## ğŸ§ª Testing Strategy

### Unit Tests
- **Location**: `*.spec.ts` files
- **Framework**: Jest
- **Coverage**: Aim for >80% coverage

### Integration Tests
- **E2E Tests**: Playwright (náº¿u cáº§n)
- **API Tests**: Supertest cho NestJS

### Manual Testing
- **Checklist**: Test trÃªn multiple browsers, devices
- **Accessibility**: Test vá»›i screen readers
- **Performance**: Check Lighthouse scores

## ğŸš« Common Mistakes to Avoid

### âŒ Don't Do This
- âŒ Commit code chÆ°a lint/format
- âŒ Push code vá»›i TypeScript errors
- âŒ Skip error handling
- âŒ Hardcode values thay vÃ¬ constants
- âŒ Ignore accessibility
- âŒ Skip responsive design
- âŒ Commit `.env` files
- âŒ Break CQRS pattern (backend)
- âŒ Use `'use client'` khÃ´ng cáº§n thiáº¿t (frontend)
- âŒ Import láº¡i Global modules trong feature modules
- âŒ Import statements khÃ´ng Ä‘Ãºng thá»© tá»± (pháº£i theo simple-import-sort)

### âœ… Do This Instead
- âœ… Lint vÃ  format trÆ°á»›c khi commit
- âœ… Fix táº¥t cáº£ TypeScript errors
- âœ… Handle errors properly
- âœ… Use constants/enums
- âœ… Test accessibility
- âœ… Test responsive design
- âœ… Use `.env.example` template
- âœ… Follow CQRS pattern
- âœ… Prefer Server Components
- âœ… Inject Global module services trá»±c tiáº¿p (khÃ´ng cáº§n import module)
- âœ… Sáº¯p xáº¿p imports theo thá»© tá»±: side effects â†’ node built-ins â†’ external â†’ path aliases â†’ relative
- âœ… Cháº¡y `pnpm lint --fix` Ä‘á»ƒ auto-fix import order

## ğŸ“Š Performance Best Practices

### Frontend
- **Image Optimization**: WebP format, proper sizes
- **Code Splitting**: Dynamic imports cho large components
- **Lazy Loading**: Lazy load below-the-fold content
- **Caching**: Use Next.js caching strategies

### Backend
- **Database Queries**: Optimize queries, use indexes
- **Caching**: Redis caching cho frequently accessed data
- **Pagination**: Always paginate list queries
- **Connection Pooling**: Proper database connection pooling

## ğŸ” Security Best Practices

### Frontend
- **Input Validation**: Validate user input
- **XSS Prevention**: Sanitize user-generated content
- **CSRF Protection**: Use Next.js CSRF protection
- **Secure Headers**: Set proper security headers

### Backend
- **Authentication**: JWT vá»›i proper expiration
- **Authorization**: Check permissions
- **Input Validation**: class-validator
- **SQL Injection**: Prisma protects against SQL injection
- **Rate Limiting**: Implement rate limiting

## ğŸ”Œ NestJS Module Best Practices

### Global Modules
- **Definition**: Modules Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u `@Global()` cÃ³ thá»ƒ Ä‘Æ°á»£c inject vÃ o báº¥t ká»³ module nÃ o mÃ  khÃ´ng cáº§n import
- **Current Global Modules**: 
  - `PrismaModule` - Database access
  - `RedisModule` - Redis operations
  - `ConfigModule` - Environment configuration (vá»›i `isGlobal: true`)

### Rules for Global Modules
1. **DO NOT import Global modules** trong feature modules (AuthModule, ProductsModule, etc.)
2. **DO import Global modules** chá»‰ á»Ÿ `AppModule` Ä‘á»ƒ Ä‘áº£m báº£o chÃºng Ä‘Æ°á»£c load
3. **DO inject Global services directly** - Chá»‰ cáº§n inject service, khÃ´ng cáº§n import module
4. **Example**:
   ```typescript
   // âŒ WRONG - Import láº¡i Global module
   @Module({
     imports: [PrismaModule, RedisModule], // KhÃ´ng cáº§n!
   })
   
   // âœ… CORRECT - Inject service trá»±c tiáº¿p
   @Module({})
   export class SomeModule {
     constructor(
       private readonly prisma: PrismaService, // Tá»± Ä‘á»™ng available
       private readonly redis: RedisService    // Tá»± Ä‘á»™ng available
     ) {}
   }
   ```

### Benefits
- **Cleaner imports**: Giáº£m sá»‘ lÆ°á»£ng imports khÃ´ng cáº§n thiáº¿t
- **Better performance**: TrÃ¡nh duplicate module loading
- **Easier maintenance**: Centralized module management

## ğŸ“ Logging & Monitoring

### Frontend
- **Error Logging**: Log errors to monitoring service
- **User Actions**: Track important user actions (analytics)

### Backend
- **Request Logging**: Log API requests
- **Error Logging**: Log errors vá»›i stack traces
- **Performance**: Monitor slow queries

## ğŸ¯ Success Criteria

Má»™t feature Ä‘Æ°á»£c coi lÃ  hoÃ n thÃ nh khi:
- [ ] Code Ä‘Ã£ lint vÃ  format
- [ ] TypeScript khÃ´ng cÃ³ errors
- [ ] Functionality hoáº¡t Ä‘á»™ng Ä‘Ãºng
- [ ] Error handling Ä‘áº§y Ä‘á»§
- [ ] Responsive design (frontend)
- [ ] Accessibility checked (frontend)
- [ ] Documentation updated
- [ ] FEATURES.log updated
