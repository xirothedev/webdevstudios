// =========================================
// BLOG MANAGEMENT (Hybrid Storage: PostgreSQL + R2)
// =========================================

model BlogPost {
  id    String @id @default(cuid())
  slug  String @unique
  title String @db.VarChar(255)

  // Content stored in R2
  contentUrl  String // R2 URL to markdown file (e.g., "blog/posts/{id}/content.md")
  contentSize Int? // File size in bytes (for monitoring)

  // Searchable excerpt (stored in DB for full-text search)
  excerpt String? @db.VarChar(500)

  // Cover image (also in R2)
  coverImage String? // R2 URL to cover image

  authorId String
  author   User   @relation(fields: [authorId], references: [id])

  // Metadata
  isPublished Boolean   @default(false)
  publishedAt DateTime?
  viewCount   Int       @default(0)

  // SEO
  metaTitle       String? @db.VarChar(255)
  metaDescription String? @db.VarChar(500)

  // Relations
  tags     BlogTag[]
  comments BlogComment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([isPublished, publishedAt])
  @@index([authorId])
  @@index([title]) // Index for title search
  @@index([excerpt]) // Index for excerpt search
  @@map("blog_posts")
}

model BlogTag {
  id   String @id @default(cuid())
  name String @unique @db.VarChar(50)
  slug String @unique @db.VarChar(50)

  posts BlogPost[]

  @@map("blog_tags")
}

model BlogComment {
  id       String   @id @default(cuid())
  content  String   @db.Text
  postId   String
  post     BlogPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  authorId String
  author   User     @relation(fields: [authorId], references: [id])

  parentId String? // For nested comments
  parent   BlogComment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies  BlogComment[] @relation("CommentReplies")

  isApproved Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
  @@index([authorId])
  @@map("blog_comments")
}
