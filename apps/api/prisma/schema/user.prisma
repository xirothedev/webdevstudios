// Copyright (c) 2026 Xiro The Dev <lethanhtrung.trungle@gmail.com>
//
// Source Available License
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to:
// - View and study the Software for educational purposes
// - Fork this repository on GitHub for personal reference
// - Share links to this repository
//
// THE FOLLOWING ARE PROHIBITED:
// - Using the Software in production or commercial applications
// - Copying substantial portions of the Software into other projects
// - Distributing modified versions of the Software
// - Removing or altering copyright notices
//
// For commercial licensing or usage permissions, contact: lethanhtrung.trungle@gmail.com
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND.
//
// =========================================
// USER & AUTHENTICATION
// =========================================

model User {
  id       String   @id @default(uuid())
  email    String   @unique @db.VarChar(255)
  password String?  @db.Text // Nullable because OAuth users don't have password
  fullName String?  @db.VarChar(100)
  phone    String?  @db.VarChar(15)
  avatar   String?  @db.Text
  role     UserRole @default(CUSTOMER)

  // MFA fields
  mfaEnabled Boolean @default(false)
  mfaSecret  String? @db.Text // TOTP secret (encrypted)

  emailVerified Boolean @default(false)
  phoneVerified Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  addresses        Address[]
  orders           Order[]
  reviews          Review[]
  cart             Cart? // 1 User has only 1 active cart
  externalAccounts ExternalAccount[] // OAuth accounts
  mfaMethods       UserMFAMethod[] // MFA methods
  mfaBackupCodes   MFABackupCode[] // MFA backup codes
  devices          Device[] // Logged devices
  sessions         Session[] // Active sessions
  blogPosts        BlogPost[] // Blog posts authored by user
  blogComments     BlogComment[] // Blog comments by user

  @@map("users")
}

model Address {
  id        String  @id @default(cuid())
  userId    String
  recipient String  @db.VarChar(100) // Recipient name
  phone     String  @db.VarChar(15)
  street    String  @db.Text
  city      String  @db.VarChar(50)
  district  String  @db.VarChar(50)
  ward      String  @db.VarChar(50)
  isDefault Boolean @default(false)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("addresses")
}
