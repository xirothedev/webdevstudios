# Auto-push to xirothedev when pushing to origin (if remote exists)

remote_name="$1"

# Only act when pushing to origin
if [ "$remote_name" != "origin" ]; then
  exit 0
fi

# Skip if the extra remote does not exist locally
if ! git remote get-url xirothedev >/dev/null 2>&1; then
  echo "‚ÑπÔ∏è  Remote 'xirothedev' not found. Skipping auto-push."
  exit 0
fi

target_branch=""

# Read refs from stdin to determine branch
while read local_ref local_sha remote_ref remote_sha; do
  if echo "$remote_ref" | grep -qE '^refs/heads/'; then
    target_branch=$(echo "$remote_ref" | sed 's|refs/heads/||')
    break
  fi
done

# Fallback to current branch if not determined
if [ -z "$target_branch" ]; then
  target_branch=$(git symbolic-ref --short HEAD 2>/dev/null || git rev-parse --abbrev-ref HEAD 2>/dev/null)
fi

# If still empty, do nothing
if [ -z "$target_branch" ]; then
  echo "‚ÑπÔ∏è  Could not determine branch. Skipping auto-push."
  exit 0
fi

echo "üîÑ Auto-pushing to xirothedev remote..."
echo "   Branch: $target_branch"

git push xirothedev "$target_branch" || {
  echo "‚ö†Ô∏è  Failed to push to xirothedev remote"
  echo "   You can push manually with: git push xirothedev $target_branch"
}

exit 0

